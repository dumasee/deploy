## iptables 配置文件 模板
```
root@myLab-server001:~# cat /etc/iptables.rules 
#Generated by iptables-save v1.6.0 on Thu Dec 28 14:15:28 2017
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [687:79920]
-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A INPUT -p tcp -m multiport --dports 22 -j ACCEPT
-A INPUT -m state --state ESTABLISHED -j ACCEPT
-A INPUT -j LOG --log-prefix iptables-input-DROP-
-A INPUT -j DROP
COMMIT
# Completed on Thu Dec 28 14:15:28 2017
root@myLab-server001:~# 
```

## iptables配置命令
- 配置
```
/sbin/iptables -A INPUT -p tcp --dport 22 -s 47.99.129.32 -j ACCEPT
/sbin/iptables -A INPUT -p tcp --dport 22 -s 192.168.3.0/22 -j ACCEPT
/sbin/iptables -A INPUT -p tcp --dport 22 -j DROP
```



- 保存配置
```
/sbin/iptables-save > /etc/iptables.rules
```

- 查看配置
```
root@gpuworker-cui-001:~# cat /etc/iptables.rules
# Generated by iptables-save v1.8.4 on Thu Mar 11 10:07:16 2021
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [378:63852]
-A INPUT -s 47.99.129.32/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 112.17.170.150/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -j DROP
-A INPUT -j ACCEPT
COMMIT
# Completed on Thu Mar 11 10:07:16 2021
```

- iptables 操作命令
```
iptables-save > /etc/iptables.rules   #保存规则
iptables-restore /etc/iptables.rules  #恢复规则，直接覆盖。
iptables -nL      #查看防火墙规则
iptables -nL -v   #查看生效的规则及统计信息
iptables -nL -v --line-numbers   #显示行号
iptables -Z  #统计清零
iptables -P INPUT ACCEPT   #配置默认处理行为
iptables -F   #清除所有规则
iptables -D INPUT 2   #删除指定行
```

## 禁止从本机发起ssh连接
/sbin/iptables -A INPUT -p tcp --sport 22  -j REJECT

## 限制并发连接
iptables -A INPUT -p tcp --dport 3080 -m connlimit --connlimit-upto 1 -j ACCEPT

## 限速
iptables -A INPUT -p tcp --dport 3080 -m limit --limit 3/minute -j ACCEPT
iptables -A INPUT -p tcp --dport 3080 -j DROP


## Centos7 iptables 
yum remove firewalld   #删除缺省的firewalld
yum install iptables   #安装iptables
service iptables save
iptables: Saving firewall rules to /etc/sysconfig/iptables: [  OK  ]
