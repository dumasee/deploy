
1. 功能 <br>
下单。
2. 处理逻辑说明 
   表结构（订单表）： <br>
```
   CREATE TABLE `oms_order` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '订单id',
  `member_id` bigint(20) NOT NULL,
  `coupon_id` bigint(20) DEFAULT NULL,
  `order_sn` varchar(255) DEFAULT NULL COMMENT '订单编号',
  `create_time` datetime DEFAULT NULL COMMENT '提交时间',
  `member_username` varchar(512) DEFAULT NULL COMMENT '用户帐号',
  `total_amount` decimal(32,2) DEFAULT NULL COMMENT '订单总金额',
  `pay_amount` decimal(32,2) DEFAULT '0.00' COMMENT '应付金额（实际支付金额）',
  `freight_amount` decimal(32,2) DEFAULT NULL COMMENT '运费金额',
  `promotion_amount` decimal(32,2) DEFAULT NULL COMMENT '促销优化金额（促销价、满减、阶梯价）',
  `integration_amount` decimal(32,2) DEFAULT NULL COMMENT '积分抵扣金额',
  `coupon_amount` decimal(32,2) DEFAULT NULL COMMENT '优惠券抵扣金额',
  `discount_amount` decimal(32,2) DEFAULT NULL COMMENT '管理员后台调整订单使用的折扣金额',
  `pay_type` int(11) DEFAULT NULL COMMENT '支付方式：0->未支付；1->支付宝；2->微信',
  `source_type` int(11) DEFAULT NULL COMMENT '订单来源：0->PC订单；1->app订单',
  `status` int(11) DEFAULT NULL COMMENT '订单状态：0->待付款；1->待发货；2->已发货；3->已完成；4->已关闭；5->无效订单',
  `order_type` int(11) DEFAULT NULL COMMENT '订单类型：0->正常订单；1->秒杀订单',
  `delivery_company` varchar(64) DEFAULT NULL COMMENT '物流公司(配送方式)',
  `delivery_sn` varchar(64) DEFAULT NULL COMMENT '物流单号',
  `auto_confirm_day` int(11) DEFAULT NULL COMMENT '自动确认时间（天）',
  `integration` int(11) DEFAULT NULL COMMENT '可以获得的积分',
  `growth` int(11) DEFAULT NULL COMMENT '可以活动的成长值',
  `promotion_info` varchar(100) DEFAULT NULL COMMENT '活动信息',
  `bill_type` int(11) DEFAULT NULL COMMENT '发票类型：0->不开发票；1->电子发票；2->纸质发票',
  `bill_header` varchar(200) DEFAULT NULL COMMENT '发票抬头',
  `bill_content` varchar(200) DEFAULT NULL COMMENT '发票内容',
  `bill_receiver_phone` varchar(32) DEFAULT NULL COMMENT '收票人电话',
  `bill_receiver_email` varchar(64) DEFAULT NULL COMMENT '收票人邮箱',
  `receiver_name` varchar(100) DEFAULT NULL COMMENT '收货人姓名',
  `receiver_phone` varchar(32) DEFAULT NULL COMMENT '收货人电话',
  `receiver_post_code` varchar(32) DEFAULT NULL COMMENT '收货人邮编',
  `receiver_province` varchar(32) DEFAULT NULL COMMENT '省份/直辖市',
  `receiver_city` varchar(32) DEFAULT NULL COMMENT '城市',
  `receiver_region` varchar(32) DEFAULT NULL COMMENT '区',
  `receiver_detail_address` varchar(200) DEFAULT NULL COMMENT '详细地址',
  `note` varchar(500) DEFAULT NULL COMMENT '订单备注',
  `confirm_status` int(11) DEFAULT NULL COMMENT '确认收货状态：0->未确认；1->已确认',
  `delete_status` int(11) NOT NULL DEFAULT '0' COMMENT '删除状态：0->未删除；1->已删除',
  `use_integration` int(11) DEFAULT NULL COMMENT '下单时使用的积分',
  `payment_time` datetime DEFAULT NULL COMMENT '支付时间',
  `delivery_time` datetime DEFAULT NULL COMMENT '发货时间',
  `receive_time` datetime DEFAULT NULL COMMENT '确认收货时间',
  `comment_time` datetime DEFAULT NULL COMMENT '评价时间',
  `modify_time` datetime DEFAULT NULL COMMENT '修改时间',
  `prepay_id` varchar(255) DEFAULT NULL,
  `supply_id` bigint(20) DEFAULT NULL,
  `goods_id` bigint(20) DEFAULT NULL,
  `goods_name` varchar(255) DEFAULT NULL,
  `school_id` bigint(20) DEFAULT NULL,
  `store_id` int(11) DEFAULT '1' COMMENT '所属店铺',
  `receiver_id` bigint(20) DEFAULT NULL,
  `group_id` bigint(20) DEFAULT NULL,
  `tax_type` smallint(6) DEFAULT '1' COMMENT '是否开发票 1=不发票 2=个人发票 3=公司发票',
  `tax_content` varchar(255) CHARACTER SET utf8mb4 DEFAULT '商品详情' COMMENT '发票内容',
  `tax_code` varchar(50) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT '税号',
  `tax_title` varchar(50) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT '发票抬头',
  `is_comment` tinyint(3) unsigned NOT NULL COMMENT '是否评论，1未评论，2已评论',
  `store_name` varchar(255) DEFAULT NULL,
  `pid` bigint(20) DEFAULT NULL,
  `vip_amount` decimal(32,0) DEFAULT '0',
  `commission` varchar(255) DEFAULT NULL,
  `address` varchar(255) DEFAULT NULL COMMENT '地址',
  `private_key` varchar(255) DEFAULT NULL,
  `private_key_path` varchar(255) DEFAULT NULL,
  `is_imputation` int(11) DEFAULT '0' COMMENT '0未归集  1已归集',
  `actual_pay_amount` decimal(32,2) DEFAULT NULL COMMENT '实际支付金额',
  `cny_amount` decimal(32,2) DEFAULT NULL COMMENT '人民币价格',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5045 DEFAULT CHARSET=utf8 COMMENT='订单表';
```
  （1)下单 <br>
   库存减去勾购买数量，生成订单，自增已售数量，对商品id+用户id加锁,该订单支付前不允许该用户再次购买该商品，生成区块链地址。定时任务查询该地址从下单时间开始总的充值交易，如果在规定时间内充值交易总额小于订单金额，自动取消订单，解锁，增加库存，减少销量；如果大于等于，订单状态变更，用户融值增加，融值记录增加。如果是实物商品，订单进入待发货状态，后台发货，状态变为已发货，待用户收货，状态变为已完成。如果是权证商品，权证表根据用户id和商品id增加或更新记录，订单状态变更为已完成。 <br>
3. 相关影响分析 <br>
    不影响其他模块。 <br>