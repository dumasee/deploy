 XWiki - 设计文档.IPFS.Fil幸运值相关因素 - Fil幸运值相关因素以及优化策略       

* * *

**1，随机数基数**  
a）存储算力占全网比率  
该因素最为重要，实际的掷骰子成功率即根据该比率用泊松分布算法来计算  
该因素无法优化  
b）前一个高度Tipset的权重和基数的最优结果  
随机数根据前一个高度的Tipset中的所有区块信息和当前算力的全网占比，计算一个比较基数，后续计算的随机值大于该基数则有机会出块，小于该基数则没有机会出块

**2，网络**  
a）联通的节点数量，链接的节点数量是动态变更的，大部分时候每个节点保持了200-300个节点连接，连接的节点越多，区块同步越快，延迟率越低  
b）2500评分的节点数，2500评分的节点实际上是全网的主干节点，连接到主干节点越多则延迟率越低  
c）网络带宽，网络带宽对网络延迟率的影响较小，理论上delta时间大于15s基本认为是无法参与到当前高度的爆块竞争中了  
**3，磁盘I/O**  
a）磁盘IO对爆块的影响小于对windpost的影响，爆块计算是随机读取某个扇区的数据，目前的官方版本，winningpost的验证已经稳定在2秒左右了，已经不会影响爆块  
b）nfs网络影响，miner到存储的网络带宽越大，nfs访问越快，nfs环境下，当前的winningpost的验证已经稳定在2秒左右了，已经不会影响爆块  
**4，计算资源**  
a）GPU冲突，winningpost和windpost都会使用GPU，拆分进程也需要考虑拆分独立的GPU，避免冲突，目前来看尚未发现windpost和winningpost的GPU冲突日志  
b）其他计算资源冲突，winningpost同进程里的封装扇区的消息上发，任务处理，会影响CPU和内存的资源利用，拆分主机独立运行能避免CPU和内存的资源使用影响

**优化点：**  
1，网络，根据对比经验，网络带宽100M，爆块幸运值会比较高，需要进一步对比验证  
验证对比方案  
a）单矿池带宽增加到100M  
b）多矿池公用lotus节点，带宽增加到100M

2，磁盘IO  
a）增加miner到存储的网络贷款  
b）存储的cache配置优化  
c）fil的cache目录文件存储到SSD(1P算力需要2368T的SSD存储空间)

3，计算资源  
a）拆分winningpost主机和windowpost主机  
b）miner主机增加显卡，winningpost和windpost显卡拆分隔离

4，随机数预测  
在保证最佳Tipset连接的情况下，尽量减小随机数基数的计算结果

